<div class="content group">
  <section class="content-sidebar">
  
		<%= render "sidebar" %>
	
  </section>
  <section class="content-main">
  
    <header class="content-header">
      <h1>Film. Experienced.</h1>
    </header>
  
    <div class="posts" id="carousel">
			<ul>
				<li><%= link_to (image_tag "now_you_see_me.jpg"), "/movies/2" %></li>
				<li><%= link_to (image_tag "man-of-steel-henry-cavill5.jpg"), "/movies/3" %></li>
				<li><%= link_to (image_tag "the-internship.jpg"), "/movies/1" %></li>
			</ul>			
    </div>
		
	  <div id="carousel-nav">
	    <span class="previous">Previous</span> &mdash;
	    <strong class="number">0 / 0</strong> &mdash;
	    <span class="next">Next</span>
	  </div>
  
  </section>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script>

var Carousel = (function(){
	
	var delay = 4000;
	var carousel = $("#carousel");
	var itemsHolder = carousel.find("> ul");
	var items = itemsHolder.find("> li");
	var itemWidth = items.first().width();
	var currentItem = -1;
	var timerId;
	
	var nextButton = $("#carousel-nav > .next");
  var previousButton = $("#carousel-nav > .previous");
  var numberLabel = $("#carousel-nav > .number");
	
	var init = function(){
		itemsHolder.css({"width": (items.length * itemWidth) + "px"});
		bind();
		start();
	};
	
  var bind = function(){
    nextButton.on("click", next);
    previousButton.on("click", previous);
  }
	
	var start = function(){
		loop();
		timerId = window.setInterval(loop, delay);
	}
	
	var stop = function(){
		if(timerId){
			window.clearInterval(timerId);
		}
	}
	
	var loop = function(){
		next();
	}
	
	var next = function(){
		currentItem++;
		
		if(currentItem == items.length){
			currentItem = 0;
		}
		
		move();
	};
	
	var previous = function(){
		currentItem--;
		
		if(currentItem <= 0){
			currentItem = items.length - 1;
		}
		
		move();
	}
	
	var move = function(){
		var html = (currentItem + 1) + " / " + items.length;
		numberLabel.html(html);
		
		var leftPosition = currentItem * itemWidth * -1;
		itemsHolder.stop().animate({"left": leftPosition + "px"}, 1000);
	}
	
	return {
		init: init,
		next: next,
		previous: previous,
		start: start,
		stop: stop
	}
})();

$(document).ready(function(){
	Carousel.init();
});

</script>